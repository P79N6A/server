<div id="body" style="max-width:88ex;margin:auto">
the title is a bit tongue-in cheek, but find is in fact quite useful. an alternative to sorted-ranges available in <a href=datastructure.html>an index datastructure</a> or textual search available via groonga or grep
<h2>find(1), a modern and fast query-engine</h2>
<div style="max-width:78ex">in surveying a vast wasteland of media-player and
media-library applications, one finds a number of recurring trends:

<h4>one-off, ad-hoc schemas and/or databases</h4>
blobtacular binary files where &quot;schemas&quot; are only defined in C header files,
SQLite schemas, apps which require MYSQL or Postgress running
<h4>scanning processes/daemons</h4>
these databases have to be populated with data, and kept in synch with the
filesystem. thus the birth of trackerd, amarok-collection-scanner, a whole
cornucopia of things likely to be chewing 100% CPU and even network bandwidth
constantly sniffing around to see if any new stuff has been added, and reading
inside the beginning of the file to look for id3 tags, then seeking to the end
to look for id3v2..
<h4>an import/synch process</h4>
in addition to the scanners, users are given a way to manually add paths. in
the worst case, a la iPod the resulting 'database' of binary blobs and files in
no way resembles the original and you need special reverse-engineered libraries
like <a href="http://gtkpod.org/libgpod/">libgpod</a> to access the data in a
sort of (in)sane manner. it copied around and obfuscated a bunch of shit in a
cat-and-mouse game of meeting the whims of a popular consumer brand. libgpod is
25257 lines of C code
<h2>names</h2>

with a nearly universal decision by media app developers that an orthogonal
database is required and the heroic efforts to populate/sync it, youd expect
the data to be pretty good to make it worth it. <strong><em>the data is
terrible.</em></strong> about 50% of files do not have id3 tags, so UNKNOWN
ARTIST is as big as the rest of the library combined. people can't be arsed to
enter in metadata.<br />
<br />
an interesting thing about filesystems is they force you to come up with a name
(unlike eg, <a href="http://camlistore.org/">camlistore</a> which is happy just
hash the contents for an identifier). since the user is forced to at least
enter a name for the folder or zip/rar container, one generally has the album
and artist name
<h3>solution</h3>
eliminating one-off databases, scanning daemons, and synch overhead, can be
achieved by using a filesystem as the database. the question then becomes it
realistic to query it at runtime? yes<br />
<br />
this is all the database code for my music library:
<pre style="padding-left:1em">

fn 'graph/audioNodes',-&gt;e,q,m{
t=q['n'] &amp;&amp; q['n'].match(/^\d+$/) &amp;&amp; '-ctime -'+q['n']
s=q['s'] &amp;&amp; q['s'].match(/^\d+$/) &amp;&amp; '-size +'+q['s']+'M'
r=(q['r'] ? '.*'+q['r'].gsub(/[^a-zA-Z0-9\.\ ]/,'') : '') + '.*.\(aif\|flac\|m4a\|mp3\|ogg\|wav\)'
`find #{e.sh} #{t} #{s} -iregex &quot;#{r}&quot;`.each_line{|p|p=p[Blen..-2];m[p]={'uri'=&gt;p}}}
</pre>
3 optional arguments exist
<p><strong>n</strong> how new? (days)</p>

<p><strong>s</strong> how big? (Mb)</p>
<p><strong>r</strong> matching name</p>
<h4>example</h4>
<p>&quot; all the Alexander Nut podcasts from the last few months &quot;<br />
<br />
<img src="nut.png" /></p>
</div>
<p>&quot; everything downloaded in the past 3 days, in plain text &quot;<br /></p>

<pre style="font-size:.78em;white-space:pre-wrap">
<span style="background-color:white;color:black">
[carmen@11 ~]$ curl &quot;http://f/m/??=a&amp;n=3&amp;format=text/uri&quot;
/m/s/afx tape trax/01.flac
/m/s/afx tape trax/02.flac
/m/s/afx tape trax/03.flac
/m/s/afx tape trax/04.flac
/m/s/afx tape trax/05.flac
/m/s/afx tape trax/06.flac
/m/s/afx tape trax/07.flac
/m/s/afx tape trax/08.flac
/m/s/afx tape trax/09.flac
/m/s/afx tape trax/10.flac
/m/s/afx tape trax/11.flac
/m/s/afx tape trax/12.flac
/m/s/afx tape trax/13.flac
/m/s/afx tape trax/14.flac
/m/s/Sandstorm-Mix.mp3
/m/s/b/BR #39 DJ MA1 b2b T. Williams 1.mp3
/m/s/b/BR #40 Lil Silva.mp3
/m/s/b/BR #40 Marcus Nasty ft MC Shantie.mp3
/m/s/b/BR #40 Shy FX ft Donaeo.mp3
/m/s/b/China Shop -  Kowtow.mp3
/m/s/b/deviation_morganzarate.mp3
/m/s/b/lookatme__bok_bok_refix.mp3
/m/s/b/Phuturelabs Mix.mp3
/m/s/b/Producers to Watch #7_ Damu.mp3
/m/s/b/URB_Presents__Lukid.mp3
/m/s/b/URB_Presents__Morgan_Zarate.mp3
/m/s/b/We-Make-It-Good-Mix-Series-Vol.-10.mp3
/m/s/b/When I Dip.mp3
/m/s/b/XLR8R_Podcast_Canblaster_2011_01_25.mp3
/m/s/b/BTS_Radio_Charlie_Dark_420_Mix/Charlie Dark (Blacktronica, UK) - Reggae 45 Mix - A Special 420 Presentation.mp3
/m/s/b/BTS_Radio_Morgan_Zarate_Guest_Mix/Morgan Zarate (Spacek, UK) - FaintHearted - Guest Mix for Andrew Meza's BTS Radio.mp3
/m/s/b/VA - Morgan Geist Presents Unclassics/01 Untro.m4a
/m/s/b/VA - Morgan Geist Presents Unclassics/02 Discotheque.m4a
/m/s/b/VA - Morgan Geist Presents Unclassics/03 Zodiac.m4a
/m/s/b/VA - Morgan Geist Presents Unclassics/04 Pluton &amp; Humanoids.m4a
/m/s/b/VA - Morgan Geist Presents Unclassics/05 Unrhythm Trax.m4a
/m/s/b/VA - Morgan Geist Presents Unclassics/06 Margueritas.m4a
/m/s/b/VA - Morgan Geist Presents Unclassics/07 Eurofunk.m4a
/m/s/b/VA - Morgan Geist Presents Unclassics/08 Victor.m4a
/m/s/b/VA - Morgan Geist Presents Unclassics/09 Plasic Mode.m4a
/m/s/b/VA - Morgan Geist Presents Unclassics/10 Dance Reaction.m4a
/m/s/b/VA - Morgan Geist Presents Unclassics/11 Purple Flash Orchestra.m4a
/m/s/b/VA - Morgan Geist Presents Unclassics/12 Purple Flash.m4a
/m/s/b/VA - Morgan Geist Presents Unclassics/13 Gaz Nevada.m4a
/m/s/b/Morgan Geist - Environ Into A Separate Space [PHONO CD 03]/01. Morgan Geist - Embark.mp3
</span>
</pre>
<p>&quot; i want to sort on ID3 tag contents, ive created good metadata &quot;<br />
<br />
<a href="http://gitorious.org/element/element/blobs/master/ruby/W/audio.rb#line9"><img src="smiths.png" />

</a></p>
