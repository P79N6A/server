#!/bin/sh

# OS deps TODO figure out distro automatically and make distro packages
#termux
pkg install graphicsmagick git ruby ruby-dev grep file findutils pkg-config libxslt-dev clang tmux make rsync libffi-dev python python-dev libcrypt-dev openssl-tool openssl-dev
#debian
apt-get install graphicsmagick git ruby ruby-dev grep file findutils pkg-config libssl-dev libxslt-dev clang tmux make rsync libffi-dev python-dev python3-pip

# Ruby library
cd ruby
ruby install

# Ruby deps
gem install bundler
bundle install

# Python deps
pip3 install --upgrade mitmproxy pygments

# certificate
cert=$(realpath ~/.mitmproxy/mitmproxy-ca-cert.pem)
hash=$(openssl x509 -inform PEM -subject_hash_old -in $cert -noout)
su -c "cp $cert /system/etc/security/cacerts/$hash.0"
